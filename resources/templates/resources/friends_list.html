{% extends 'base.html' %}
{% block title %}Friends - Academic Assistant{% endblock %}
{% block content %}
<style>
    .friends-container {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .page-header h1 {
        color: var(--primary-blue);
        font-size: 2rem;
    }
    
    .section {
        background: var(--white);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .section-title {
        color: #2c3e50;
        font-size: 1.25rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--light-blue);
    }
    
    .friends-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1rem;
    }
    
    .friend-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: var(--light-blue);
        border-radius: 12px;
        transition: all 0.2s;
    }
    
    .friend-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .friend-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary-blue);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        font-weight: bold;
        object-fit: cover;
        flex-shrink: 0;
    }
    
    .friend-info {
        flex: 1;
    }
    
    .friend-name {
        color: #2c3e50;
        font-weight: 600;
        margin-bottom: 0.25rem;
    }
    
    .friend-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .btn-small {
        padding: 0.375rem 0.75rem;
        font-size: 0.85rem;
        border-radius: 6px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        transition: all 0.2s;
        border: none;
        cursor: pointer;
    }
    
    .btn-chat {
        background: var(--primary-blue);
        color: white;
    }
    
    .btn-chat:hover {
        background: var(--dark-blue);
    }
    
    .btn-remove {
        background: var(--danger);
        color: white;
    }
    
    .btn-remove:hover {
        background: #c82333;
    }
    
    .btn-accept {
        background: var(--success);
        color: white;
    }
    
    .btn-accept:hover {
        background: #218838;
    }
    
    .btn-decline {
        background: var(--text-gray);
        color: white;
    }
    
    .btn-decline:hover {
        background: #5a6268;
    }
    
    .btn-add-friend {
        background: var(--primary-blue);
        color: white;
    }
    
    .btn-add-friend:hover {
        background: var(--dark-blue);
    }
    
    .empty-state {
        text-align: center;
        padding: 2rem;
        color: #6c757d;
    }
</style>

<div class="friends-container">
    <div class="page-header">
        <h1><svg class="icon-lg" style="vertical-align: middle;"><use href="#icon-users"></use></svg> Friends</h1>
        <a href="{% url 'add_friend' %}" class="btn btn-primary">+ Add Friend</a>
    </div>

    <!-- Friend Requests Received -->
    {% if received_requests %}
    <div class="section">
        <h2 class="section-title"><svg class="icon" style="vertical-align: middle;"><use href="#icon-bell"></use></svg> Friend Requests ({{ received_requests.count }})</h2>
        <div class="friends-grid">
            {% for request in received_requests %}
            <div class="friend-card">
                <a href="{% url 'public_profile' request.from_user.username %}" style="text-decoration: none;">
                    {% if request.from_user.profile.profile_picture %}
                    <img src="{{ request.from_user.profile.profile_picture.url }}" alt="{{ request.from_user.username }}" class="friend-avatar">
                    {% else %}
                    <div class="friend-avatar">{{ request.from_user.username|slice:":1"|upper }}</div>
                    {% endif %}
                </a>
                <div class="friend-info">
                    <a href="{% url 'public_profile' request.from_user.username %}" style="text-decoration: none;">
                        <div class="friend-name">{{ request.from_user.username }}</div>
                    </a>
                    <small style="color: var(--text-gray);">{{ request.created_at|timesince }} ago</small>
                </div>
                <div class="friend-actions">
                    <a href="{% url 'accept_friend_request' request.id %}" class="btn-small btn-accept"><svg class="icon-sm" style="vertical-align: middle;"><use href="#icon-check"></use></svg></a>
                    <a href="{% url 'decline_friend_request' request.id %}" class="btn-small btn-decline">âœ—</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- My Friends -->
    <div class="section">
        <h2 class="section-title">Friends ({{ friends.count }})</h2>
        {% if friends %}
        <div class="friends-grid">
            {% for friend in friends %}
            <div class="friend-card">
                <a href="{% url 'public_profile' friend.username %}" style="text-decoration: none;">
                    {% if friend.profile.profile_picture %}
                    <img src="{{ friend.profile.profile_picture.url }}" alt="{{ friend.username }}" class="friend-avatar">
                    {% else %}
                    <div class="friend-avatar">{{ friend.username|slice:":1"|upper }}</div>
                    {% endif %}
                </a>
                <div class="friend-info">
                    <a href="{% url 'public_profile' friend.username %}" style="text-decoration: none;">
                        <div class="friend-name">{{ friend.username }}</div>
                    </a>
                </div>
                <div class="friend-actions">
                    <a href="{% url 'start_private_chat' friend.id %}" class="btn-small btn-chat"><svg class="icon-sm" style="vertical-align: middle;"><use href="#icon-message"></use></svg></a>
                    <a href="{% url 'remove_friend' friend.id %}" class="btn-small btn-remove" 
                       onclick="return confirm('Remove {{ friend.username }} from friends?')"><svg class="icon-sm" style="vertical-align: middle;"><use href="#icon-trash"></use></svg></a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p>You don't have any friends yet. Start by adding people from your study groups!</p>
        </div>
        {% endif %}
    </div>

    <!-- Pending Sent Requests -->
    {% if sent_requests %}
    <div class="section">
        <h2 class="section-title"><svg class="icon" style="vertical-align: middle;"><use href="#icon-clock"></use></svg> Pending Requests ({{ sent_requests.count }})</h2>
        <div class="friends-grid">
            {% for request in sent_requests %}
            <div class="friend-card">
                <a href="{% url 'public_profile' request.to_user.username %}" style="text-decoration: none;">
                    {% if request.to_user.profile.profile_picture %}
                    <img src="{{ request.to_user.profile.profile_picture.url }}" alt="{{ request.to_user.username }}" class="friend-avatar">
                    {% else %}
                    <div class="friend-avatar">{{ request.to_user.username|slice:":1"|upper }}</div>
                    {% endif %}
                </a>
                <div class="friend-info">
                    <a href="{% url 'public_profile' request.to_user.username %}" style="text-decoration: none;">
                        <div class="friend-name">{{ request.to_user.username }}</div>
                    </a>
                    <small style="color: var(--text-gray);">Sent {{ request.created_at|timesince }} ago</small>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Suggested Friends from Groups -->
    {% if potential_friends %}
    <div class="section">
        <h2 class="section-title">ðŸ’¡ People You May Know</h2>
        <div class="friends-grid">
            {% for user in potential_friends %}
            <div class="friend-card">
                <a href="{% url 'public_profile' user.username %}" style="text-decoration: none;">
                    {% if user.profile.profile_picture %}
                    <img src="{{ user.profile.profile_picture.url }}" alt="{{ user.username }}" class="friend-avatar">
                    {% else %}
                    <div class="friend-avatar">{{ user.username|slice:":1"|upper }}</div>
                    {% endif %}
                </a>
                <div class="friend-info">
                    <a href="{% url 'public_profile' user.username %}" style="text-decoration: none;">
                        <div class="friend-name">{{ user.username }}</div>
                    </a>
                    <small style="color: var(--text-gray);">From study groups</small>
                </div>
                <div class="friend-actions">
                    <a href="{% url 'add_friend_from_group' user.id %}" class="btn-small btn-add-friend">+ Add</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
